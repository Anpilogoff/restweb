<html>
<head>
    <style>



        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            background:  radial-gradient(
                    circle closest-corner at center 225px,
                    #222,
                    black 40%);
            display: block	;
            justify-content: center;
            align-items: center;
        }

        p {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -70px);
            color: #ddd;
            text-align: center;
            text-transform: uppercase;
            font-family: "Nova Mono", monospace;
            font-size: 0.8em;
            font-weight: bold;
            letter-spacing: 2px;
            user-select: none;
        }

        span {
            display: block;
            font-size: 1.6em;
        }

        div {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px dashed #ddd;
            border-radius: 10%;
            cursor: pointer;
        }

        img {
            width: 270px;
            height: 270px;
            filter: invert();
        }

        input {
            display: none;
        }

        canvas {
            transform: 	rotateX(180deg);
            top:10%;
            left: 	15%;
            position: 	absolute;
            width: 	600px;
            height:600px;
            display: none;
        }

        .buttons{
            top: 10%;
            position: relative;
            float: 	left;
            width: 	35px;
            height: 35px;
            box-shadow: white 3px 1px 2px;
            color: black;
            background-color: green;

        }





        .button-container{
            border-radius: 	50px;
            position: 	absolute;
            color: red;
            font-size: 20px;
            font-weight: bolder	;
            top: 	-20%;
            width: 	200px;
            height: 	50px;
            box-shadow: 	black 3px 1px 2px 0px;
        }

        .fa-arrow-circle-o-up{
            color: black;
            position: relative;
            left: 0px;
            font-size: 	20px;
        }
    </style>
    <link rel="stylesheet" href="https:/cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
<p>click or drag</p>
<div class="dropzone">

    <input type="file" accept="audio/*">
</div>

<canvas>


</canvas>
<div button-container>
    <button class="buttons" id="playBtn"><i class="fa fa-play" id="check"></i></button>
    <button class="buttons" id="stopBtn"><i class="fa fa-stop" id="check2"></i></button>

    <button class="buttons" id="forwardBtn"><i class="fa fa-minus"></i></button>
    <button class="buttons" id="backBtn"><i class="fa fa-plus"></i></button>
</div>


<script>
    let dropZone = document.querySelector("div"),
        input = document.querySelector("input"),
        file,
        text,
        progress,
        volume,
        audio,
        frequencyArray;


    var playBtn, stopBtn, forwardBtn, backBtn;
    playBtn = document.getElementById('playBtn');
    stopBtn = document.getElementById('stopBtn');
    forwardBtn = document.getElementById('forwardBtn');
    backBtn = document.getElementById('backBtn');


    playBtn.addEventListener("click", function () {
        alert('audio.attributes');

        if(audio.getAttribute("param") == null){
            audio.setAttribute("param", "playing");

            audio.play();
        }

        if(audio.getAttribute("param") === "playing"){
            audio.setAttribute("param", "paused")
            document.getElementById('check').className = "fa fa-play";
            audio.pause();
        }
        else if(audio.getAttribute("param") === "paused"){
            document.getElementById('check').className = "fa fa-pause";
            audio.setAttribute("param", "playing");
            audio.play();
        }

    });


    stopBtn.addEventListener("click", function (e) {
        document.getElementById('check2').style.color = "red";
        document.getElementById('check').className = "fa fa-pause";


        audio.setAttribute("param", "paused");
        audio.pause();
    });

    forwardBtn.addEventListener('click', function (e) {
        audio.volume -= 0.1;
    });

    backBtn.addEventListener('click', function (e) {
        audio.volume += 0.1;
    });


    dropZone.ondrop = (e) => {
        e.preventDefault();

        if (e.dataTransfer.items[0].kind == "file") {
            file = e.dataTransfer.items[0].getAsFile();
        } else return;

        playTrack(file);
    };

    dropZone.ondragover = (e) => {
        e.preventDefault();
    };

    dropZone.onclick = () => {
        input.click();
        input.onchange = () => {
            file = input.files[0];

            playTrack(file);
        };
    };

    let C = document.querySelector("canvas"),
        $ = C.getContext("2d"),
        W = (C.width = innerWidth),
        H = (C.height = innerHeight),
        centerX = W /2,
        centerY = H / 2,
        radius,
        piece,
        bars = 11,
        x,
        y,
        xEnd,
        yEnd,
        barWidth = 3,
        barHeight,
        lineColor;

    function playTrack(file) {
        dropZone.style.display = "none";

        text = document.querySelector("p");

        text.style.transform = "translate(-10%,-10%)";

        text.innerHTML = `progress: <span class="progress"></span> <br> volume: <span class="volume"></span>`;

        volume = document.querySelector(".volume");

        progress = document.querySelector(".progress");



        document.addEventListener("keydown", (e) => {
            try {


                if (e.keyCode == 39) {
                    audio.currentTime += 10;
                } else if (e.keyCode == 37) {
                    audio.currentTime -= 10;
                } else if (e.keyCode == 40) {
                    audio.volume -= 0.1;
                } else if (e.keyCode == 38) {
                    audio.volume += 0.1;
                }
            } catch {
                return;
            }
        });



        console.log(
            "Use Keyboard: \n Space to Play/Pause \n Enter to Stop \n Arrows to Change \n Time and Volume"
        );

        audio = new Audio();
        context = new AudioContext();
        analyser = context.createAnalyser();

        audio.src = URL.createObjectURL(file);
        source = context.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(context.destination);

        frequencyArray = new Uint8Array(analyser.frequencyBinCount);

        audio.play();

        audio.loop = true;

        startAnimation();

        function startAnimation() {
            C.style.display = "block";

            piece = audio.currentTime / audio.duration;

            radius = 1;

            $.clearRect(0, 0, W, H);

            $.beginPath();
            $.arc(centerX, centerY, radius, 0, Math.PI * (2 * piece));
            $.lineWidth = 1;
            $.stroke();

            volume.innerText = Math.trunc(audio.volume * 100) + "%";

            progress.innerText = Math.trunc(piece * 100) + "%";
            analyser.getByteFrequencyData(frequencyArray);
            for (let i = 0; i < bars; i++) {
                radius = 100;
                rads = (Math.PI * 1) / bars;
                barHeight = frequencyArray[i] * 0.8;

                x = centerX + Math.cos(rads * i) * radius;
                y = centerY + Math.sin(rads * i) * radius;
                xEnd = centerX + Math.cos(rads * i) * (radius + barHeight);
                yEnd = centerY + Math.sin(rads * i) * (radius + barHeight);

                drawBar(x, y, xEnd, yEnd, barWidth, frequencyArray[i]);
            }
            requestAnimationFrame(startAnimation);
        }

        function drawBar(x1, y1, x2, y2, width, frequency) {
            lineColor = "rgb(" + frequency + ", " + frequency + ", " + 205 + ")";

            $.strokeStyle = lineColor;
            $.lineWidth = width;
            $.beginPath();
            $.moveTo(x1, y1);
            $.lineTo(x2, y2);
            $.stroke();
        }
    }

</script>
</body>
</html>